dmake_version: 0.1
app_name: deepomatic-client-python
env:
  default:
    source: ${DEEPOMATIC_CONFIG_DIR}/dev.sh
    variables:
      DEEPOMATIC_APP_ID: ${TEST_CLIENTS_APP_ID}
      DEEPOMATIC_API_KEY: ${TEST_CLIENTS_API_KEY}
  branches:
    master:
      source: ${DEEPOMATIC_CONFIG_DIR}/prod.sh


docker:
  base_image:
    - &base_image_template
      variant: python2
      name: deepomatic-client-python
      root_image: ubuntu:16.04
      install_scripts:
        - tests/install_python2.sh
      copy_files:
        - requirements.txt
    - <<: *base_image_template
      variant: python3
      install_scripts:
        - tests/install_python3.sh


services:
  - service_name: client
    config:
      docker_image:
        base_image_variant:
          - python2
          - python3
    tests:
      commands:
        - tests/test_demo.sh
